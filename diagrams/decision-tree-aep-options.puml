@startuml AEP Zero-Copy Decision Tree

skinparam defaultTextAlignment center
skinparam ActivityBackgroundColor #FFE4B5
skinparam ActivityBorderColor #333
skinparam ActivityFontSize 11

title AEP Zero-Copy Architecture - Decision Tree\n(Banking/GCP Environment)

start

:START
====
You have BigQuery lead scoring
Need to activate via AEP;

note right
  **Context:**
  • Lead classification in BigQuery
  • Activate to marketing channels
  • Minimize data transfer
end note

partition "CRITICAL SECURITY CHECK" {
  :Security/Compliance Check;

  if (Can you expose BigQuery\nto external systems?) then (YES - Approved)

    note right
      ✓ Security approved
      ✓ VPN/IP allowlist OK
      ✓ BaFin compliant
    end note

    partition "LATENCY REQUIREMENTS" {
      if (Need real-time\nactivation <5 min?) then (NO - Batch OK)

        #90EE90:OPTION 1 (RECOMMENDED)
        ====
        **Federated Audience Composition**
        ====
        • Query BigQuery in-place
        • 99.96% data reduction
        • $247K-$701K/year
        • Zero vendor lock-in;

        stop

      else (YES - Real-Time)

        if (What % need\nreal-time?) then (<10%)

          #DDA0DD:OPTION 3 (HYBRID)
          ====
          **Hybrid Selective Pattern**
          ====
          • 99% Federated (batch)
          • 1% Streaming (real-time)
          • $286K-$693K/year;

          stop

        elseif (10-50%) then

          if (Prefer?) then (Cost)

            #DDA0DD:OPTION 3 (HYBRID)
            ====
            **Hybrid Selective**
            ====
            • Optimize costs
            • $286K-$693K/year;

            stop

          else (Simplicity)

            #87CEEB:OPTION 2
            ====
            **Computed Attributes**
            ====
            • Single architecture
            • $248K-$858K/year;

            stop

          endif

        else (>50%)

          #87CEEB:OPTION 2
          ====
          **Computed Attributes**
          ====
          • Stream to AEP
          • 2-10 min latency
          • $248K-$858K/year;

          stop

        endif

      endif
    }

  else (NO - BLOCKED)

    note right #FFB6C1
      ✗ Security blocks external access
      ✗ BaFin restrictions
      ✗ Data residency rules
      **FAC NOT POSSIBLE**
    end note

    partition "PUSH-BASED OPTIONS" {
      #FFB6C1:Must use push-based patterns;

      if (Need real-time\n<5 min?) then (YES)

        #87CEEB:OPTION 2
        ====
        **Computed Attributes**
        ====
        • Stream derived scores
        • 2-10 min latency
        • $248K-$858K/year;

        stop

      else (NO - Batch OK)

        if (Can build audiences\nin BigQuery?) then (YES)

          #FFDAB9:OPTION 4 (POC ONLY)
          ====
          **External Audiences**
          ====
          • Manual CSV/API upload
          • 30-day TTL
          • $112K-$292K/year
          • NOT for production;

          note right
            Use for POC only
            Lobby for FAC approval
          end note

          stop

        else (NO)

          #FFB6C1:NO VIABLE OPTION
          ====
          **Recommendations:**
          1. Lobby for FAC approval
          2. OR use GCP-native
             (skip AEP);

          stop

        endif

      endif
    }

  endif
}

@enduml
